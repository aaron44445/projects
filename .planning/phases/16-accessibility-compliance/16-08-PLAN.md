---
phase: 16-accessibility-compliance
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/staff/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Add Staff modal announces as dialog"
    - "Modal title is announced"
    - "Close button has aria-label"
    - "Focus is trapped in modal"
    - "Escape closes modal"
  artifacts:
    - path: "apps/web/src/app/staff/page.tsx"
      provides: "Accessible Add Staff modal"
      contains: "role=\"dialog\""
  key_links:
    - from: "staff/page.tsx modal"
      to: "FocusTrap"
      via: "focus-trap-react import"
      pattern: "import.*FocusTrap.*focus-trap-react"
---

<objective>
Fix Add Staff Modal ARIA - Make custom modal accessible

Purpose: UAT Gap 2 revealed that the Add Staff modal (staff/page.tsx lines 1252-1408) is a custom implementation that doesn't use Modal.tsx. It lacks proper ARIA attributes and focus trap.

Output: Accessible Add Staff modal with proper ARIA and focus management
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/app/staff/page.tsx
@packages/ui/src/components/Modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ARIA and Focus Trap to Add Staff Modal</name>
  <files>apps/web/src/app/staff/page.tsx</files>
  <action>
The Add Staff modal (showNewStaff state, lines 1252-1408) needs accessibility improvements:

1. Add FocusTrap import at top:
   ```tsx
   import FocusTrap from 'focus-trap-react';
   ```

2. Add useId import and generate IDs for ARIA:
   ```tsx
   import { useState, useMemo, useEffect, useCallback, useId } from 'react';

   // Inside StaffContent function:
   const staffModalTitleId = useId();
   ```

3. Wrap the modal content with FocusTrap:
   ```tsx
   {showNewStaff && (
     <div className="fixed inset-0 bg-charcoal/50 flex items-center justify-center z-50 p-4">
       <FocusTrap
         active={true}
         focusTrapOptions={{
           escapeDeactivates: false,
           returnFocusOnDeactivate: true,
         }}
       >
         <div
           role="dialog"
           aria-modal="true"
           aria-labelledby={staffModalTitleId}
           className="bg-white dark:bg-sidebar rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-auto"
         >
   ```

4. Add id to the modal title (line ~1257):
   ```tsx
   <h2 id={staffModalTitleId} className="text-xl font-bold text-charcoal dark:text-white">
   ```

5. Add aria-label to close button (line ~1260):
   ```tsx
   <button
     onClick={closeStaffModal}
     aria-label="Close"
     className="p-2 text-charcoal/40 ..."
   >
   ```

6. Add escape key handler useEffect:
   ```tsx
   useEffect(() => {
     const handleEscape = (e: KeyboardEvent) => {
       if (e.key === 'Escape' && showNewStaff) {
         closeStaffModal();
       }
     };

     if (showNewStaff) {
       document.addEventListener('keydown', handleEscape);
     }

     return () => {
       document.removeEventListener('keydown', handleEscape);
     };
   }, [showNewStaff]);
   ```

7. Also fix the Location Assignment Modal (showLocationModal, lines 1123-1249) and Delete Confirmation Modal (deleteConfirm, lines 1411-1442) with the same pattern:
   - Add role="dialog", aria-modal="true", aria-labelledby
   - Add aria-label="Close" to close buttons
   - Wrap with FocusTrap
   - Generate unique IDs with useId()
  </action>
  <verify>
1. Build succeeds: `cd apps/web && npm run build`
2. No TypeScript errors
3. Grep confirms: `grep -n "role=\"dialog\"" apps/web/src/app/staff/page.tsx`
  </verify>
  <done>All three modals in staff/page.tsx have proper ARIA attributes, focus traps, and escape handlers</done>
</task>

</tasks>

<verification>
1. `cd apps/web && npm run build` passes
2. All modals have role="dialog", aria-modal="true", aria-labelledby
3. All close buttons have aria-label="Close"
4. FocusTrap wraps all modal content
</verification>

<success_criteria>
- Add Staff modal has role="dialog" and aria-labelledby
- Location Assignment modal has proper ARIA
- Delete Confirmation modal has proper ARIA
- All modals trap focus and respond to Escape
- Close buttons are labeled for screen readers
</success_criteria>

<output>
After completion, create `.planning/phases/16-accessibility-compliance/16-08-SUMMARY.md`
</output>
