---
phase: 16-accessibility-compliance
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/layout.tsx
  - apps/web/src/app/page.tsx
  - apps/web/src/app/globals.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Skip link is first focusable element"
    - "Skip link moves focus to main content"
    - "Landing page has main element"
  artifacts:
    - path: "apps/web/src/app/layout.tsx"
      provides: "Skip link outside Providers"
      contains: "skip-link"
    - path: "apps/web/src/app/page.tsx"
      provides: "Landing page structure"
  key_links:
    - from: "skip-link"
      to: "main#main-content"
      via: "href=#main-content"
      pattern: "href=\"#main-content\""
---

<objective>
Fix Skip Link Navigation - Ensure skip link works correctly

Purpose: UAT Gap 6 revealed that skip link exists but main element is nested inside Providers incorrectly. Also landing page wraps content in div, not main.

Output: Working skip to main content link on all pages
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/app/layout.tsx
@apps/web/src/app/page.tsx
@apps/web/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix layout.tsx skip link structure</name>
  <files>apps/web/src/app/layout.tsx</files>
  <action>
Current structure (lines 67-81):
```tsx
<body className="font-sans">
  <a href="#main-content" className="skip-link">
    Skip to main content
  </a>
  <Providers>
    <main id="main-content" tabIndex={-1}>
      {children}
    </main>
  </Providers>
  <CookieConsent />
</body>
```

The issue is that main is INSIDE Providers. This should work, but let's verify:
1. The skip link href="#main-content" should work
2. The main has id="main-content" and tabIndex={-1}
3. tabIndex={-1} allows programmatic focus

Actually looking at the code again, this structure appears correct. The main element IS inside Providers, which is fine - Providers is just a context wrapper that renders its children.

Let's verify the skip-link CSS (globals.css lines 122-133):
```css
.skip-link {
  @apply absolute bg-charcoal text-white px-4 py-2 font-medium z-[100];
  @apply -translate-y-full focus:translate-y-0;
  @apply transition-transform duration-200;
  top: 0;
  left: 0;
}

.skip-link:focus {
  @apply outline-none ring-2 ring-sage ring-offset-2;
}
```

This CSS hides the skip link off-screen and reveals it on focus. This is correct.

The actual fix needed: Ensure the skip link is truly the FIRST focusable element in the DOM. Check if there are any elements before it that might receive focus.

Looking at layout.tsx, the skip link is immediately after `<body>` tag, which is correct.

Potential issue: The `-translate-y-full` might be hiding it but the link should still be focusable.

Let's add a backup approach - also use `sr-only` until focused:
1. Update skip-link CSS to use clip-path approach for better compatibility
2. Ensure the skip link appears on first Tab press
  </action>
  <verify>
1. Build succeeds: `cd apps/web && npm run build`
2. Grep confirms structure: `grep -n "skip-link\|main-content" apps/web/src/app/layout.tsx`
  </verify>
  <done>Layout skip link structure is correct with main element having proper id and tabIndex</done>
</task>

<task type="auto">
  <name>Task 2: Update skip-link CSS for better visibility</name>
  <files>apps/web/src/app/globals.css</files>
  <action>
Enhance the skip-link CSS to ensure it's more reliably hidden but focusable:

Replace lines 122-133 with:
```css
/* Skip to main content link */
.skip-link {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 100;
  padding: 0.5rem 1rem;
  background-color: #2D3142; /* charcoal */
  color: white;
  font-weight: 500;
  text-decoration: none;
  /* Hidden by default using clip */
  clip: rect(0 0 0 0);
  clip-path: inset(50%);
  height: 1px;
  width: 1px;
  overflow: hidden;
  white-space: nowrap;
}

.skip-link:focus {
  /* Visible when focused */
  clip: auto;
  clip-path: none;
  height: auto;
  width: auto;
  overflow: visible;
  outline: 2px solid #7C9A82; /* sage */
  outline-offset: 2px;
}
```

This uses the same technique as sr-only but reveals on focus, which is more reliable across browsers.
  </action>
  <verify>
1. Build succeeds: `cd apps/web && npm run build`
2. CSS is valid
  </verify>
  <done>Skip link CSS uses clip-path technique for reliable show/hide on focus</done>
</task>

<task type="auto">
  <name>Task 3: Verify landing page structure</name>
  <files>apps/web/src/app/page.tsx</files>
  <action>
Looking at page.tsx (lines 30-56), the landing page returns:
```tsx
<div className="min-h-screen bg-cream dark:bg-zinc-900 transition-colors">
  <OrganizationSchema />
  <Navigation />
  <HeroSection />
  ...
</div>
```

The root element is a div, not main. However, this page is rendered INSIDE the main element from layout.tsx, so it inherits the main wrapper.

The structure in browser will be:
```html
<main id="main-content" tabIndex="-1">
  <div class="min-h-screen...">
    <!-- landing page content -->
  </div>
</main>
```

This is actually correct! The landing page content IS inside main because layout.tsx wraps {children} with main.

No changes needed to page.tsx - the main element comes from the layout.

Verify by checking that page.tsx is wrapped by layout.tsx's main element (it is, by Next.js convention).
  </action>
  <verify>
1. Confirm layout structure wraps children in main
2. Landing page will inherit the main wrapper
  </verify>
  <done>Landing page inherits main element from layout.tsx - no changes needed</done>
</task>

</tasks>

<verification>
1. `cd apps/web && npm run build` passes
2. Skip link is first focusable element in body
3. Skip link targets #main-content
4. Main element has id="main-content" and tabIndex={-1}
5. Skip link CSS hides until focused
</verification>

<success_criteria>
- Skip link is positioned correctly in DOM (first in body)
- Skip link href points to #main-content
- Main element has correct id and tabIndex
- Skip link is hidden until Tab key pressed
- Skip link becomes visible on focus
</success_criteria>

<output>
After completion, create `.planning/phases/16-accessibility-compliance/16-10-SUMMARY.md`
</output>
