# Plan 16-01: Modal Focus Trap and ARIA Compliance

---
phase: 16-accessibility-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/ui/src/components/Modal.tsx
  - apps/web/src/components/BookingModal.tsx
  - packages/ui/package.json
autonomous: true

must_haves:
  truths:
    - "Modal traps focus when open (Tab key cycles within modal)"
    - "Focus returns to trigger element when modal closes"
    - "Screen reader announces modal dialog role"
  artifacts:
    - path: "packages/ui/src/components/Modal.tsx"
      provides: "Accessible modal with focus trap"
      min_lines: 40
      contains: "role=\"dialog\""
    - path: "apps/web/src/components/BookingModal.tsx"
      provides: "Accessible booking modal"
      contains: "aria-modal"
  key_links:
    - from: "packages/ui/src/components/Modal.tsx"
      to: "focus-trap-react"
      via: "FocusTrap component wrapper"
      pattern: "FocusTrap"
---

<objective>
Add ARIA compliance and focus management to all modal dialogs.

Purpose: Screen reader users and keyboard-only users need proper modal behavior - focus should be trapped inside the modal and return to the trigger when closed.
Output: Modal.tsx and BookingModal.tsx with role="dialog", aria-modal="true", and FocusTrap wrapper.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/ui/src/components/Modal.tsx
@apps/web/src/components/BookingModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Install focus-trap-react dependency</name>
  <files>packages/ui/package.json</files>
  <action>
Run: `cd packages/ui && npm install focus-trap-react@^11.0.6`

This library handles focus trapping edge cases (iframe focus, shadow DOM, etc.) and is the standard solution for accessible modals.
  </action>
  <verify>Run `grep "focus-trap-react" packages/ui/package.json` - should show the dependency</verify>
  <done>focus-trap-react@^11.0.6 is in packages/ui/package.json dependencies</done>
</task>

<task type="auto">
  <name>Update Modal.tsx with ARIA attributes and focus trap</name>
  <files>packages/ui/src/components/Modal.tsx</files>
  <action>
1. Import FocusTrap from focus-trap-react
2. Add `role="dialog"` and `aria-modal="true"` to the modal container
3. Generate unique IDs for aria-labelledby (title) and aria-describedby (description)
4. Wrap modal content with FocusTrap component:
   - `active={true}` (modal only renders when open)
   - `focusTrapOptions={{ escapeDeactivates: false, returnFocusOnDeactivate: true }}`
5. Add `aria-label="Close"` to the close button (X icon)
6. Export ModalProps type for external use
  </action>
  <verify>
Run these commands - all should return matches:
- `grep "role=\"dialog\"" packages/ui/src/components/Modal.tsx`
- `grep "aria-modal=\"true\"" packages/ui/src/components/Modal.tsx`
- `grep "FocusTrap" packages/ui/src/components/Modal.tsx`
- `grep "aria-label=\"Close\"" packages/ui/src/components/Modal.tsx`
  </verify>
  <done>Modal.tsx has role="dialog", aria-modal="true", FocusTrap wrapper, and accessible close button</done>
</task>

<task type="auto">
  <name>Update BookingModal.tsx with ARIA compliance</name>
  <files>apps/web/src/components/BookingModal.tsx</files>
  <action>
BookingModal is a custom implementation not using the shared Modal component. Apply same accessibility treatment:

1. Add `role="dialog"` and `aria-modal="true"` to the modal container
2. Add unique IDs and aria-labelledby for the title
3. Add `aria-label="Close"` to the close button
4. Wrap modal content with FocusTrap (import from focus-trap-react)
5. Store ref to trigger button and return focus on close
  </action>
  <verify>
Run these commands - all should return matches:
- `grep "role=\"dialog\"" apps/web/src/components/BookingModal.tsx`
- `grep "aria-modal=\"true\"" apps/web/src/components/BookingModal.tsx`
- `grep "FocusTrap" apps/web/src/components/BookingModal.tsx`
  </verify>
  <done>BookingModal.tsx has role="dialog", aria-modal="true", and FocusTrap wrapper</done>
</task>

<task type="auto">
  <name>Build and verify both packages</name>
  <files>packages/ui/src/components/Modal.tsx, apps/web/src/components/BookingModal.tsx</files>
  <action>
1. Run `npm run build -w packages/ui` to verify Modal.tsx compiles
2. Run `npm run build -w apps/web` to verify BookingModal.tsx compiles

If build fails, fix TypeScript errors before proceeding.
  </action>
  <verify>Both build commands complete with exit code 0</verify>
  <done>Both packages/ui and apps/web build successfully with no TypeScript errors</done>
</task>

</tasks>

<verification>
```bash
# Verify ARIA attributes are present
grep -r "role=\"dialog\"" packages/ui/src/components/Modal.tsx
grep -r "aria-modal=\"true\"" packages/ui/src/components/Modal.tsx
grep -r "aria-label=\"Close\"" packages/ui/src/components/Modal.tsx
grep -r "FocusTrap" packages/ui/src/components/Modal.tsx

# Same for BookingModal
grep -r "role=\"dialog\"" apps/web/src/components/BookingModal.tsx
grep -r "aria-modal=\"true\"" apps/web/src/components/BookingModal.tsx
```

All greps should return matches.
</verification>

<success_criteria>
- Modal has `role="dialog"` attribute
- Modal has `aria-modal="true"` attribute
- Modal is wrapped with FocusTrap component (focus-trap-react)
- Close button has `aria-label="Close"`
- BookingModal has same ARIA attributes as Modal
- Both components build without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-accessibility-compliance/16-01-SUMMARY.md`
</output>
