---
phase: 16-accessibility-compliance
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/embed/[slug]/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Time slot buttons announce availability status"
    - "Time slot selection announces via aria-live"
    - "Date buttons announce selection state"
  artifacts:
    - path: "apps/web/src/app/embed/[slug]/page.tsx"
      provides: "Accessible booking widget"
      contains: "role=\"radiogroup\""
  key_links:
    - from: "DateTimeStep"
      to: "aria-live region"
      via: "announcement state"
      pattern: "aria-live=\"polite\""
---

<objective>
Fix Booking Widget Accessibility - Time slots and dates

Purpose: UAT Gaps 3, 4, 5 revealed that aria-labels, aria-live, and aria-pressed exist in code but aren't rendering in DOM. Investigation needed to find why JSX attributes aren't reaching the DOM.

Output: Booking widget with working screen reader announcements
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/app/embed/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Debug and fix time slot accessibility</name>
  <files>apps/web/src/app/embed/[slug]/page.tsx</files>
  <action>
UAT found that aria-labels and aria-live exist in code but aren't in DOM. Debug and fix:

1. **Check aria-live region (lines 593-600):**
   The current code:
   ```tsx
   <div
     role="status"
     aria-live="polite"
     aria-atomic="true"
     className="sr-only"
   >
     {announcement}
   </div>
   ```

   This looks correct. Verify:
   - sr-only class exists in globals.css (confirmed at line 153)
   - announcement state is being set (line 653)

   If it's not rendering, check if it's inside a conditional that prevents rendering.

2. **Add radiogroup semantics to time slots container (line 646):**
   ```tsx
   <div
     role="radiogroup"
     aria-label="Available appointment times"
     className="grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-[200px] overflow-y-auto"
   >
   ```

3. **Fix time slot buttons (lines 650-667):**
   Change from button to proper radio semantics:
   ```tsx
   <button
     key={slot.time}
     onClick={() => {
       setAnnouncement(`${formatTime(slot.time)} selected`);
       onTimeSelect(slot.time);
     }}
     role="radio"
     aria-checked={isSelected}
     aria-label={`${formatTime(slot.time)}, ${slot.available !== false ? 'available' : 'unavailable'}`}
     disabled={slot.available === false}
     className={...}
   >
   ```

4. **Add radiogroup to date container (around line 609):**
   ```tsx
   <div
     role="radiogroup"
     aria-label="Select appointment date"
     className="flex gap-2 overflow-x-auto pb-2 -mx-1 px-1"
   >
   ```

5. **Fix date buttons (lines 613-627):**
   Add role="radio" and aria-checked:
   ```tsx
   <button
     key={date}
     onClick={() => onDateChange(date)}
     role="radio"
     aria-checked={isSelected}
     aria-label={`${formatDateLabel(date)}, ${isSelected ? 'selected' : 'select this date'}`}
     className={...}
   >
   ```
   Note: Remove aria-pressed, use aria-checked with role="radio" instead (more appropriate for selection).

6. **Ensure announcement updates are triggered:**
   Add announcement for date selection too:
   ```tsx
   onClick={() => {
     setAnnouncement(`${formatDateLabel(date)} selected`);
     onDateChange(date);
   }}
   ```
  </action>
  <verify>
1. Build succeeds: `cd apps/web && npm run build`
2. Grep confirms radiogroup: `grep -n "role=\"radiogroup\"" apps/web/src/app/embed/[slug]/page.tsx`
3. Grep confirms aria-checked: `grep -n "aria-checked" apps/web/src/app/embed/[slug]/page.tsx`
  </verify>
  <done>Time slots and date buttons have proper radiogroup semantics and aria-checked, aria-live region announces selections</done>
</task>

</tasks>

<verification>
1. `cd apps/web && npm run build` passes
2. Time slots container has role="radiogroup"
3. Time slot buttons have role="radio" and aria-checked
4. Date container has role="radiogroup"
5. Date buttons have role="radio" and aria-checked
6. aria-live region exists with sr-only class
</verification>

<success_criteria>
- Time slot container has role="radiogroup" with aria-label
- Each time slot has role="radio" and aria-checked
- Date container has role="radiogroup" with aria-label
- Each date has role="radio" and aria-checked
- Selection changes trigger aria-live announcements
</success_criteria>

<output>
After completion, create `.planning/phases/16-accessibility-compliance/16-09-SUMMARY.md`
</output>
