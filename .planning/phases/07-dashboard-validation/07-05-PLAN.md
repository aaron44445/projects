---
phase: 07-dashboard-validation
plan: 05
type: execute
wave: 3
depends_on: ["07-03", "07-04"]
files_modified:
  - apps/web/src/app/dashboard/page.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard statistics match actual database appointment counts"
    - "Today's appointments display in correct timezone"
    - "Revenue shows net amount (after refunds)"
    - "Error states show user-friendly messages with retry buttons"
    - "Auto-refresh updates data every 60 seconds"
  artifacts:
    - path: "apps/web/src/app/dashboard/page.tsx"
      provides: "Complete dashboard with all Phase 7 improvements"
  key_links:
    - from: "apps/web/src/app/dashboard/page.tsx"
      to: "apps/api/src/routes/dashboard.ts"
      via: "API calls"
      pattern: "/dashboard/"
---

<objective>
Verify all Phase 7 dashboard improvements work correctly end-to-end.

Purpose: Final verification checkpoint to confirm dashboard accuracy, timezone handling, error states, and auto-refresh all work together as a spa owner would experience them.

Output: Verified working dashboard with all Phase 7 success criteria met.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-dashboard-validation/07-CONTEXT.md
@.planning/phases/07-dashboard-validation/07-01-SUMMARY.md
@.planning/phases/07-dashboard-validation/07-02-SUMMARY.md
@.planning/phases/07-dashboard-validation/07-03-SUMMARY.md
@.planning/phases/07-dashboard-validation/07-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and verify compilation</name>
  <files></files>
  <action>
Run full build to ensure all changes compile correctly:

```bash
cd apps/api && pnpm build
cd ../web && pnpm build
```

Fix any TypeScript errors that emerge.
  </action>
  <verify>Both `pnpm build` commands complete without errors.</verify>
  <done>Full build succeeds for both API and web apps.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 7 dashboard improvements including:
    1. Timezone-aware "today" calculations in API
    2. Revenue calculations subtracting refunds
    3. Auto-refresh every 60 seconds via TanStack Query
    4. Partial error states per dashboard section
    5. Timezone-aware time display on frontend
  </what-built>
  <how-to-verify>
    **Setup:**
    1. Start both dev servers:
       - `cd apps/api && pnpm dev`
       - `cd apps/web && pnpm dev`
    2. Open browser to http://localhost:3000/dashboard
    3. Open browser DevTools (Network tab)

    **Test 1: Auto-refresh (DASH-01)**
    - Watch the Network tab for ~70 seconds
    - EXPECTED: See new requests to /dashboard/stats, /dashboard/today, /dashboard/recent-activity approximately every 60 seconds
    - PASS if: Auto-refresh occurs without manual intervention

    **Test 2: Manual refresh**
    - Click the refresh button (circular arrow icon in header)
    - EXPECTED: All three API endpoints are called immediately
    - PASS if: Data refreshes on click

    **Test 3: Error handling (DASH-03)**
    - In DevTools Network tab, right-click on a dashboard request and select "Block request URL"
    - Click refresh button
    - EXPECTED: Only the blocked section shows error with "Retry" button, other sections still work
    - PASS if: Partial error states work correctly
    - Click the Retry button
    - EXPECTED: Section retries and recovers (if you unblocked)

    **Test 4: Today's appointments timezone (DASH-02)**
    - Check if any appointments show for today
    - Note the displayed times (e.g., "2:30 PM")
    - EXPECTED: Times match the salon's configured timezone (visible in Settings > General)
    - If salon timezone is different from your browser timezone, times should NOT match your local time
    - PASS if: Times display in salon timezone

    **Test 5: Statistics accuracy (DASH-01)**
    - Note the "Appointments Today" count
    - Go to Calendar page, count today's non-cancelled appointments
    - EXPECTED: Numbers match
    - Note the "Monthly Revenue" amount
    - If any refunds were processed this month, verify the revenue shows NET (gross minus refunds)
    - PASS if: Statistics appear accurate

    **Summary:**
    Report which tests passed and any issues found.
  </how-to-verify>
  <resume-signal>Type "approved" if all 5 tests pass, or describe issues found for gap closure.</resume-signal>
</task>

</tasks>

<verification>
Human verification checkpoint covers all Phase 7 success criteria:
1. Dashboard statistics match actual database counts - Test 5
2. Today's appointments display in owner's timezone - Test 4
3. Revenue tracking shows accurate totals including refunds - Test 5
4. Timezone edge cases handled correctly - Test 4
5. Error states display user-friendly messages - Test 3
</verification>

<success_criteria>
All Phase 7 success criteria from ROADMAP.md verified by human tester:
- [ ] Dashboard statistics match actual database counts (appointments, revenue, clients)
- [ ] Today's appointments display correctly in owner's timezone
- [ ] Revenue tracking shows accurate totals including refunds and adjustments
- [ ] Timezone edge cases handled correctly (DST transitions, multi-timezone locations)
- [ ] Error states display user-friendly messages (network failures, invalid states)
</success_criteria>

<output>
After completion, create `.planning/phases/07-dashboard-validation/07-05-SUMMARY.md`
</output>
