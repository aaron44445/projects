---
phase: 21-availability-time-off
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/staff/schedule/page.tsx
autonomous: true

must_haves:
  truths:
    - "Staff can view and edit their recurring weekly availability"
    - "Staff can use 'Copy to weekdays' to apply same hours to Mon-Fri"
    - "Availability changes are saved via existing PUT /my-schedule API"
  artifacts:
    - path: "apps/web/src/app/staff/schedule/page.tsx"
      provides: "Weekly availability editor with Copy to weekdays shortcut"
      contains: "Copy to weekdays"
  key_links:
    - from: "apps/web/src/app/staff/schedule/page.tsx"
      to: "/api/v1/staff-portal/my-schedule"
      via: "updateSchedule from useStaffSchedule hook"
      pattern: "updateSchedule"
---

<objective>
Audit existing recurring availability editor and add "Copy to weekdays" shortcut.

Purpose: The recurring availability editor already exists (weekly grid, per-day times, working toggle). This plan adds the "Copy to all weekdays" shortcut mentioned in CONTEXT.md for faster schedule setup.

Output: Enhanced availability editor with copy shortcut, verified against Phase 21 requirements.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-availability-time-off/21-CONTEXT.md
@.planning/phases/21-availability-time-off/21-RESEARCH.md

Key existing patterns:
- Weekly availability editor exists in schedule/page.tsx (lines 245-314)
- Uses editedSchedule state with dayOfWeek, startTime, endTime, isWorking
- updateDay function modifies single day in editedSchedule
- Save triggers updateSchedule(selectedLocationId, editedSchedule)
- TIME_OPTIONS array provides 6am-7pm in 30-min increments
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit existing availability editor</name>
  <files>apps/web/src/app/staff/schedule/page.tsx</files>
  <action>
Verify the existing availability editor meets CONTEXT.md requirements:

Requirements checklist:
- [x] Simple weekly grid: 7 days (DAYS array, lines 246-306)
- [x] Per-day start/end time inputs (select dropdowns with TIME_OPTIONS)
- [x] Toggle to mark day as "not available" (isWorking checkbox)
- [ ] Copy to all weekdays shortcut (MISSING - add in Task 2)

No code changes needed for this task - just verification.
  </action>
  <verify>
```bash
grep -n "DAYS\|TIME_OPTIONS\|isWorking\|startTime\|endTime" apps/web/src/app/staff/schedule/page.tsx | head -20
```
Confirms all existing availability components are present.
  </verify>
  <done>Existing availability editor verified: has weekly grid, time inputs, working toggle</done>
</task>

<task type="auto">
  <name>Task 2: Add "Copy to weekdays" shortcut</name>
  <files>apps/web/src/app/staff/schedule/page.tsx</files>
  <action>
Add a "Copy to weekdays" button that applies current day's schedule to Monday-Friday.

1. Add helper function after updateDay (around line 121):
```typescript
const copyToWeekdays = (sourceDayOfWeek: number) => {
  const sourceDay = editedSchedule.find(s => s.dayOfWeek === sourceDayOfWeek);
  if (!sourceDay) return;

  setEditedSchedule(prev => prev.map(s => {
    // Apply to Mon(1), Tue(2), Wed(3), Thu(4), Fri(5)
    if (s.dayOfWeek >= 1 && s.dayOfWeek <= 5) {
      return {
        ...s,
        startTime: sourceDay.startTime,
        endTime: sourceDay.endTime,
        isWorking: sourceDay.isWorking,
      };
    }
    return s;
  }));
};
```

2. Add button in the edit mode header section (around line 236, after "Save Changes" button):
```typescript
{editMode && editedSchedule.length > 0 && (
  <div className="flex items-center gap-2 ml-2 pl-2 border-l border-charcoal/20">
    <select
      onChange={(e) => {
        const dayIndex = parseInt(e.target.value);
        if (!isNaN(dayIndex)) {
          copyToWeekdays(dayIndex);
        }
        e.target.value = ''; // Reset select
      }}
      className="px-2 py-1 text-xs text-charcoal/60 border border-charcoal/20 rounded-lg"
      defaultValue=""
    >
      <option value="" disabled>Copy to weekdays...</option>
      {DAYS.map((day, i) => (
        <option key={i} value={i}>{day}</option>
      ))}
    </select>
  </div>
)}
```

Alternative simpler approach - single button that copies first working day:
```typescript
<button
  onClick={() => {
    const firstWorkingDay = editedSchedule.find(s => s.isWorking);
    if (firstWorkingDay) {
      copyToWeekdays(firstWorkingDay.dayOfWeek);
    }
  }}
  className="text-xs text-sage hover:text-sage-dark px-2 py-1"
  title="Copy current settings to Monday-Friday"
>
  Copy to weekdays
</button>
```

Use the simpler button approach for cleaner UX. Place it after the Save Changes button.
  </action>
  <verify>
```bash
grep -n "Copy to weekdays\|copyToWeekdays" apps/web/src/app/staff/schedule/page.tsx
```
Shows the new function and button.
  </verify>
  <done>Schedule editor has "Copy to weekdays" button that applies same hours to Mon-Fri</done>
</task>

<task type="auto">
  <name>Task 3: Verify availability API integration</name>
  <files>apps/web/src/app/staff/schedule/page.tsx</files>
  <action>
Verify the updateSchedule hook correctly calls PUT /my-schedule:

1. Check useStaffSchedule hook is imported (line 24)
2. Check updateSchedule is destructured (line 59)
3. Check saveSchedule calls updateSchedule (line 105)
4. Check approval workflow message is handled (lines 108-111)

No code changes needed - this is verification that wiring exists.

Add TypeScript compilation check:
```bash
cd apps/web && npx tsc --noEmit 2>&1 | head -20
```
  </action>
  <verify>
```bash
cd apps/web && npx tsc --noEmit 2>&1 | head -20
```
TypeScript compiles without errors.
  </verify>
  <done>Availability editor correctly wired to PUT /my-schedule API via updateSchedule hook</done>
</task>

</tasks>

<verification>
1. Audit check: grep confirms DAYS, TIME_OPTIONS, isWorking, time inputs present
2. Copy feature: grep -n "copyToWeekdays" shows new function
3. TypeScript: cd apps/web && npx tsc --noEmit passes
4. Visual: Schedule page in edit mode shows "Copy to weekdays" option
</verification>

<success_criteria>
- Existing availability editor has weekly grid with 7 days
- Each day has checkbox toggle and start/end time selects
- New "Copy to weekdays" button applies one day's schedule to Mon-Fri
- TypeScript compiles without errors
- Availability changes still save via updateSchedule hook
</success_criteria>

<output>
After completion, create `.planning/phases/21-availability-time-off/21-04-SUMMARY.md`
</output>
