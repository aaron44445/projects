---
phase: 08-register-missing-routers
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/api/src/index.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Notification history page loads without 404 errors"
    - "Account profile API responds to requests"
    - "Team management API responds to requests"
    - "Owner notification preferences API responds to requests"
    - "Integrations status API responds to requests"
  artifacts:
    - path: "apps/api/src/index.ts"
      provides: "Production entry point with all routers registered"
      contains: "notificationsRouter"
  key_links:
    - from: "apps/api/src/index.ts"
      to: "apps/api/src/routes/notifications.ts"
      via: "import and app.use registration"
      pattern: "import.*notificationsRouter.*from.*routes/notifications"
    - from: "apps/api/src/index.ts"
      to: "apps/api/src/routes/account.ts"
      via: "import and app.use registration"
      pattern: "import.*accountRouter.*from.*routes/account"
    - from: "apps/api/src/index.ts"
      to: "apps/api/src/routes/team.ts"
      via: "import and app.use registration"
      pattern: "import.*teamRouter.*from.*routes/team"
    - from: "apps/api/src/index.ts"
      to: "apps/api/src/routes/ownerNotifications.ts"
      via: "import and app.use registration"
      pattern: "import.*ownerNotificationsRouter.*from.*routes/ownerNotifications"
    - from: "apps/api/src/index.ts"
      to: "apps/api/src/routes/integrations.ts"
      via: "import and app.use registration"
      pattern: "import.*integrationsRouter.*from.*routes/integrations"
---

<objective>
Register missing routers in the production entry point (index.ts) to match the development entry point (app.ts).

Purpose: Fix 404 errors in production for notification history, account, team, owner notifications, and integrations APIs. These routers exist and work in development but were never added to the production Vercel serverless entry point.

Output: Updated index.ts with all 5 missing routers imported and registered, achieving parity with app.ts.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-register-missing-routers/08-RESEARCH.md

# Source files
@apps/api/src/index.ts
@apps/api/src/app.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing router imports and registrations to index.ts</name>
  <files>apps/api/src/index.ts</files>
  <action>
Add 5 missing router imports and registrations to index.ts to match app.ts:

1. Add imports after line 38 (after gdprRouter import, before errorHandler):
   ```typescript
   import { accountRouter } from './routes/account.js';
   import { teamRouter } from './routes/team.js';
   import { ownerNotificationsRouter } from './routes/ownerNotifications.js';
   import { notificationsRouter } from './routes/notifications.js';
   import { integrationsRouter } from './routes/integrations.js';
   ```

2. Add registrations after line 188 (after GDPR routes, before error handling section):
   ```typescript
   // Account and Team Routes (added from app.ts parity)
   app.use('/api/v1/account', accountRouter);
   app.use('/api/v1/team', teamRouter);

   // Notification Routes (added from app.ts parity)
   app.use('/api/v1/owner-notifications', ownerNotificationsRouter);
   app.use('/api/v1/notifications', notificationsRouter);

   // Integrations Routes (added from app.ts parity)
   app.use('/api/v1/integrations', integrationsRouter);
   ```

Match exact paths from app.ts:
- /api/v1/account (accountRouter)
- /api/v1/team (teamRouter)
- /api/v1/owner-notifications (ownerNotificationsRouter)
- /api/v1/notifications (notificationsRouter)
- /api/v1/integrations (integrationsRouter)
  </action>
  <verify>
1. TypeScript compiles without errors: `cd apps/api && npx tsc --noEmit`
2. Grep confirms all 5 imports exist in index.ts
3. Grep confirms all 5 app.use registrations exist in index.ts
  </verify>
  <done>
- All 5 routers imported in index.ts
- All 5 routers registered with correct paths in index.ts
- TypeScript compiles successfully
- index.ts has router parity with app.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify router parity between app.ts and index.ts</name>
  <files>apps/api/src/index.ts, apps/api/src/app.ts</files>
  <action>
Compare router registrations between app.ts and index.ts to confirm parity:

1. Extract all app.use('/api/v1/...' lines from both files
2. Compare the lists - they should now match
3. If any discrepancies remain, document them

Use grep to list all router registrations:
```bash
grep "app.use('/api/v1" apps/api/src/app.ts | sort
grep "app.use('/api/v1" apps/api/src/index.ts | sort
```

Expected: Both files should have the same set of /api/v1/* routes.
  </action>
  <verify>
Router count matches between files (grep -c "app.use('/api/v1" for both files returns same number)
  </verify>
  <done>
- Router registrations verified identical between app.ts and index.ts
- No missing routers in production entry point
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Compilation check**: `cd apps/api && npx tsc --noEmit` passes
2. **Import parity**: All 5 new imports exist in index.ts
3. **Registration parity**: All 5 new app.use() calls exist in index.ts
4. **Route count match**: Same number of /api/v1/* routes in both files

Note: Full API testing requires deployment. This plan ensures the code is correct; production verification happens post-deploy.
</verification>

<success_criteria>
1. notificationsRouter registered in index.ts at /api/v1/notifications
2. accountRouter registered in index.ts at /api/v1/account
3. teamRouter registered in index.ts at /api/v1/team
4. ownerNotificationsRouter registered in index.ts at /api/v1/owner-notifications
5. integrationsRouter registered in index.ts at /api/v1/integrations
6. TypeScript compiles without errors
7. Router registration count matches between app.ts and index.ts
</success_criteria>

<output>
After completion, create `.planning/phases/08-register-missing-routers/08-01-SUMMARY.md`
</output>
