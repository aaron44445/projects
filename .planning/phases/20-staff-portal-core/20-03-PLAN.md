---
phase: 20-staff-portal-core
plan: 03
type: execute
wave: 2
depends_on: [20-01]
files_modified:
  - apps/web/src/app/staff/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Past appointments are visually dimmed on dashboard"
    - "Empty state uses EmptyState component from @peacase/ui"
    - "Clicking appointment card opens detail modal with full info"
    - "Appointment details show all services, prices, notes, duration"
  artifacts:
    - path: "apps/web/src/app/staff/dashboard/page.tsx"
      provides: "Enhanced dashboard with details modal"
      contains: "AppointmentDetailModal"
  key_links:
    - from: "apps/web/src/app/staff/dashboard/page.tsx"
      to: "@peacase/ui Modal"
      via: "detail modal"
      pattern: "import.*Modal.*from.*@peacase/ui"
---

<objective>
Enhance dashboard with past appointment dimming, EmptyState component, and appointment detail modal

Purpose: Per CONTEXT.md decisions: chronological order with past appointments dimmed, EmptyState for empty views, and clicking cards shows full appointment details (SCHED-01, SCHED-04 requirements).

Output: Dashboard with visual hierarchy for past/upcoming appointments, proper empty states, and click-to-expand appointment details.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-staff-portal-core/20-CONTEXT.md
@.planning/phases/20-staff-portal-core/20-RESEARCH.md
@.planning/phases/20-staff-portal-core/20-01-SUMMARY.md
@apps/web/src/app/staff/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add past appointment dimming and EmptyState</name>
  <files>apps/web/src/app/staff/dashboard/page.tsx</files>
  <action>
    1. Import EmptyState from @peacase/ui at the top:
    ```typescript
    import { EmptyState } from '@peacase/ui';
    ```

    2. Add a helper function to check if appointment is in the past:
    ```typescript
    const isPastAppointment = (startTime: string) => {
      return new Date(startTime) < new Date();
    };
    ```

    3. Replace the empty state section (around line 260-265) with EmptyState component:
    ```tsx
    {dashboardData.todayAppointments.length === 0 ? (
      <div className="p-8">
        <EmptyState
          icon={Calendar}
          title="No appointments scheduled for today"
          description="Enjoy your free time!"
        />
      </div>
    ) : (
      // ... appointment list ...
    )}
    ```

    4. Modify the appointment card styling to dim past appointments (in the map around line 267):
    ```tsx
    dashboardData.todayAppointments.map((appointment) => {
      const isPast = isPastAppointment(appointment.startTime);
      return (
        <div
          key={appointment.id}
          className={`p-4 hover:bg-charcoal/5 transition-colors cursor-pointer ${
            isPast ? 'opacity-50' : ''
          }`}
        >
          {/* ... existing card content ... */}
        </div>
      );
    })
    ```
  </action>
  <verify>
    Run: `cd C:\projects\spa-final && npm run build -w apps/web`
    Should complete without errors.
  </verify>
  <done>Past appointments are dimmed with opacity-50, EmptyState component used for empty list</done>
</task>

<task type="auto">
  <name>Task 2: Add appointment detail modal</name>
  <files>apps/web/src/app/staff/dashboard/page.tsx</files>
  <action>
    1. Import Modal from @peacase/ui (add to existing imports):
    ```typescript
    import { EmptyState, Modal } from '@peacase/ui';
    ```

    2. Add state for selected appointment at top of DashboardContent function:
    ```typescript
    const [selectedAppointment, setSelectedAppointment] = useState<DashboardData['todayAppointments'][0] | null>(null);
    ```

    3. Update the DashboardData interface to include additional appointment fields needed for detail view:
    ```typescript
    interface DashboardData {
      todayAppointments: {
        id: string;
        clientName: string;
        serviceName: string;
        startTime: string;
        endTime: string;
        status: string;
        price: number;
        notes?: string;
        location?: { id: string; name: string };
        client?: { firstName?: string; lastName?: string; phone?: string };
        service?: { name: string; durationMinutes: number; price: number };
      }[];
      // ... rest unchanged ...
    }
    ```

    4. Make appointment cards clickable by adding onClick:
    ```tsx
    <div
      key={appointment.id}
      onClick={() => setSelectedAppointment(appointment)}
      className={`p-4 hover:bg-charcoal/5 transition-colors cursor-pointer ${
        isPast ? 'opacity-50' : ''
      }`}
    >
    ```

    5. Add the detail modal at the end of the component, before the closing </main>:
    ```tsx
    {/* Appointment Detail Modal */}
    <Modal
      isOpen={!!selectedAppointment}
      onClose={() => setSelectedAppointment(null)}
      title="Appointment Details"
      size="md"
    >
      {selectedAppointment && (
        <div className="space-y-4">
          {/* Time */}
          <div className="flex items-center gap-3 p-4 bg-sage/10 rounded-xl">
            <Clock className="w-5 h-5 text-sage" />
            <div>
              <p className="font-medium text-charcoal">
                {formatTime(selectedAppointment.startTime)} - {formatTime(selectedAppointment.endTime)}
              </p>
              <p className="text-sm text-charcoal/60">
                {new Date(selectedAppointment.startTime).toLocaleDateString('en-US', {
                  weekday: 'long',
                  month: 'long',
                  day: 'numeric',
                })}
              </p>
            </div>
          </div>

          {/* Client */}
          <div className="p-4 border border-charcoal/10 rounded-xl">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-full bg-lavender/20 flex items-center justify-center">
                <Users className="w-5 h-5 text-lavender-dark" />
              </div>
              <div>
                <p className="font-medium text-charcoal">{selectedAppointment.clientName}</p>
                {dashboardData?.staffCanViewClientContact && selectedAppointment.client?.phone && (
                  <p className="text-sm text-charcoal/60">{selectedAppointment.client.phone}</p>
                )}
              </div>
            </div>
          </div>

          {/* Service */}
          <div className="p-4 border border-charcoal/10 rounded-xl">
            <p className="text-sm text-charcoal/60 mb-2">Service</p>
            <div className="flex items-center justify-between">
              <div>
                <p className="font-medium text-charcoal">{selectedAppointment.serviceName}</p>
                {selectedAppointment.service?.durationMinutes && (
                  <p className="text-sm text-charcoal/60">
                    {selectedAppointment.service.durationMinutes} minutes
                  </p>
                )}
              </div>
              <p className="font-semibold text-sage">
                {formatCurrency(selectedAppointment.price)}
              </p>
            </div>
          </div>

          {/* Location (if multi-location) */}
          {dashboardData?.hasMultipleLocations && selectedAppointment.location && (
            <div className="p-4 border border-charcoal/10 rounded-xl">
              <p className="text-sm text-charcoal/60 mb-1">Location</p>
              <p className="font-medium text-charcoal flex items-center gap-2">
                <MapPin className="w-4 h-4 text-charcoal/40" />
                {selectedAppointment.location.name}
              </p>
            </div>
          )}

          {/* Notes (if any) */}
          {selectedAppointment.notes && (
            <div className="p-4 border border-charcoal/10 rounded-xl">
              <p className="text-sm text-charcoal/60 mb-1">Notes</p>
              <p className="text-charcoal">{selectedAppointment.notes}</p>
            </div>
          )}

          {/* Status */}
          <div className="flex items-center justify-between pt-2">
            <span className="text-sm text-charcoal/60">Status</span>
            <span
              className={`px-3 py-1 rounded-full text-sm font-medium capitalize ${getStatusColor(selectedAppointment.status)}`}
            >
              {selectedAppointment.status}
            </span>
          </div>
        </div>
      )}
    </Modal>
    ```

    6. Ensure Users icon is imported from lucide-react if not already present.
  </action>
  <verify>
    Run: `cd C:\projects\spa-final && npm run build -w apps/web`
    Should complete without errors.
  </verify>
  <done>Clicking appointment card opens modal with full details including service, duration, price, notes, and client info (respecting visibility)</done>
</task>

</tasks>

<verification>
1. Web build passes: `npm run build -w apps/web`
2. Past appointments (startTime < now) have opacity-50 class
3. Empty state uses EmptyState component with Calendar icon
4. Clicking an appointment card opens modal
5. Modal shows time, client name, phone (if allowed), service with duration/price, location (if multi-location), notes
</verification>

<success_criteria>
- Past appointments visually dimmed (opacity-50)
- EmptyState component from @peacase/ui used for empty appointment list
- Appointment cards are clickable
- Detail modal displays: time, client name, phone (conditional), service name, duration, price, location badge (if applicable), notes
- Modal uses focus-trap-react via @peacase/ui Modal component
</success_criteria>

<output>
After completion, create `.planning/phases/20-staff-portal-core/20-03-SUMMARY.md`
</output>
