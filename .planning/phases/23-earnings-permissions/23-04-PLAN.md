---
phase: 23-earnings-permissions
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/app/settings/page.tsx
  - apps/web/src/hooks/useSalon.ts
autonomous: true

must_haves:
  truths:
    - "Owner can toggle staffCanViewClientContact setting in Staff Policies section"
    - "Toggle shows descriptive label explaining what the setting controls"
    - "Setting persists when toggled and page is refreshed"
  artifacts:
    - path: "apps/web/src/app/settings/page.tsx"
      provides: "Client visibility toggle in StaffPoliciesSection"
      contains: "staffCanViewClientContact"
    - path: "apps/web/src/hooks/useSalon.ts"
      provides: "staffCanViewClientContact in Salon interface"
      contains: "staffCanViewClientContact"
  key_links:
    - from: "Toggle checkbox onChange"
      to: "updateSalon({ staffCanViewClientContact })"
      via: "useSalon hook"
      pattern: "updateSalon.*staffCanViewClientContact"
---

<objective>
Add client visibility control toggle to Salon Settings > Staff Policies section.

Purpose: Enable owners to configure whether staff can see full client contact info or only first name + last initial. This completes the PERM-01 requirement.

Output: New toggle in Staff Policies section that controls the staffCanViewClientContact salon setting.
</objective>

<execution_context>
@C:\Users\aaron\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\aaron\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-earnings-permissions/23-CONTEXT.md
@.planning/phases/23-earnings-permissions/23-RESEARCH.md

# Existing patterns:
@apps/web/src/app/settings/page.tsx (StaffPoliciesSection component, lines 143-300)
@apps/web/src/hooks/useSalon.ts (Salon interface and updateSalon function)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify staffCanViewClientContact in Salon interface</name>
  <files>apps/web/src/hooks/useSalon.ts</files>
  <action>
Check if the Salon interface already includes staffCanViewClientContact. Based on the codebase, it should since the field exists in the database schema and is used in the dashboard.

If NOT present in the Salon interface, add it:
```typescript
interface Salon {
  // ... existing fields
  staffCanViewClientContact: boolean;
  // ... etc
}
```

The updateSalon function should already accept any Partial<Salon> fields, so no changes needed there.
  </action>
  <verify>
Search for staffCanViewClientContact in useSalon.ts:
`grep -n "staffCanViewClientContact" apps/web/src/hooks/useSalon.ts`

If found, proceed. If not found, add it to the interface.
  </verify>
  <done>
Salon interface includes staffCanViewClientContact boolean field.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add client visibility toggle to Staff Policies section</name>
  <files>apps/web/src/app/settings/page.tsx</files>
  <action>
Add a new toggle to the StaffPoliciesSection component for client contact visibility:

1. Find the StaffPoliciesSection function (around line 143)

2. Add a handler for the client visibility toggle (similar to handleToggleApproval):
   ```typescript
   const handleToggleClientVisibility = async (enabled: boolean) => {
     await updateSalon({ staffCanViewClientContact: enabled });
   };
   ```

3. Add a new settings card AFTER the Time-Off Approval card (around line 205):
   ```tsx
   {/* Client Information Visibility */}
   <div className="bg-white dark:bg-sidebar rounded-2xl border border-charcoal/10 dark:border-white/10 p-6">
     <h3 className="font-semibold text-charcoal dark:text-white mb-4">Client Information Visibility</h3>
     <label className="flex items-center gap-3 cursor-pointer">
       <input
         type="checkbox"
         checked={salon?.staffCanViewClientContact ?? true}
         onChange={(e) => handleToggleClientVisibility(e.target.checked)}
         className="rounded border-charcoal/20 dark:border-white/20 text-sage focus:ring-sage w-5 h-5"
       />
       <div>
         <span className="text-charcoal dark:text-white font-medium">Allow staff to view full client contact info</span>
         <p className="text-text-muted dark:text-white/60 text-sm">
           When disabled, staff will only see first name and last initial (e.g., "Sarah M.") instead of full names, and contact details will be hidden.
         </p>
       </div>
     </label>
   </div>
   ```

This follows the exact same pattern as the existing "Require manager approval for time-off requests" toggle.
  </action>
  <verify>
Run frontend build: `npm run build --workspace apps/web`
Visit Settings > Staff Policies section:
- New "Client Information Visibility" card appears
- Toggle checkbox works
- Description text explains the setting
  </verify>
  <done>
Staff Policies section includes client visibility toggle with descriptive label. Setting persists on toggle.
  </done>
</task>

</tasks>

<verification>
1. `npm run build --workspace apps/web` completes without errors
2. Settings > Staff Policies shows "Client Information Visibility" section
3. Checkbox defaults to checked (staffCanViewClientContact defaults to true)
4. Toggling checkbox updates the salon setting
5. Page refresh shows persisted value
</verification>

<success_criteria>
- Owner can navigate to Settings > Staff Policies
- Client visibility toggle is visible with clear description
- Toggling updates the salon setting
- Setting persists across page refreshes
</success_criteria>

<output>
After completion, create `.planning/phases/23-earnings-permissions/23-04-SUMMARY.md`
</output>
