---
phase: 18-ui-ux-consistency
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - apps/web/src/components/BookingModal.tsx
autonomous: true

must_haves:
  truths:
    - "BookingModal imports Modal from @peacase/ui"
    - "BookingModal no longer has its own FocusTrap, escape key handler, or backdrop"
    - "Error states use bg-rose/10 border-rose/20 text-rose-dark pattern"
    - "Success states use bg-sage/10 border-sage/20 text-sage-dark pattern"
  artifacts:
    - path: "apps/web/src/components/BookingModal.tsx"
      provides: "Booking modal using packages/ui Modal as base"
      contains: "import { Modal } from '@peacase/ui'"
  key_links:
    - from: "apps/web/src/components/BookingModal.tsx"
      to: "packages/ui/src/components/Modal.tsx"
      via: "import"
      pattern: "import.*Modal.*@peacase/ui"
---

<objective>
Migrate BookingModal to use packages/ui Modal component and update error/success states to use design tokens.

Purpose: Eliminate duplicated modal structure (UI-01) and standardize error highlighting (UI-03) in the most-used booking modal.
Output: BookingModal using Modal as base with ~60 lines removed, consistent error/success colors.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-ui-ux-consistency/18-RESEARCH.md
@packages/ui/src/components/Modal.tsx (base Modal component)
@apps/web/src/components/BookingModal.tsx (current implementation)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor BookingModal to use packages/ui Modal</name>
  <files>apps/web/src/components/BookingModal.tsx</files>
  <action>
Refactor BookingModal to use packages/ui Modal as base:

1. Replace imports:
   - Remove: `import FocusTrap from 'focus-trap-react'`
   - Add: `import { Modal } from '@peacase/ui'`

2. Remove these sections (Modal handles them):
   - The useId() calls for titleId and descriptionId (Modal generates its own)
   - The escape key useEffect (lines 125-139)
   - The outer div with fixed positioning and backdrop
   - The FocusTrap wrapper

3. Replace the component structure with:
   ```tsx
   return (
     <Modal
       isOpen={isOpen}
       onClose={onClose}
       title="Book Appointment"
       description={prefilledClientName ? `for ${prefilledClientName}` : undefined}
       size="lg"
     >
       {/* Form content only - no header, Modal provides it */}
       <div className="space-y-5">
         {/* Error/success messages */}
         {/* Client selection */}
         {/* Service selection */}
         {/* Staff selection */}
         {/* Date/time */}
         {/* Notes */}
       </div>

       {/* Footer with actions */}
       <div className="flex gap-3 pt-6 border-t border-charcoal/10 dark:border-white/10 -mx-6 px-6 -mb-6 pb-6">
         {/* Cancel and Book buttons */}
       </div>
     </Modal>
   );
   ```

4. Update error state colors:
   - Replace `bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 text-red-700 dark:text-red-400`
   - With `bg-rose/10 dark:bg-rose/20 border-rose/20 dark:border-rose/30 text-rose-dark dark:text-rose`

5. Update success state colors:
   - Replace `bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 text-green-700 dark:text-green-400`
   - With `bg-sage/10 dark:bg-sage/20 border-sage/20 dark:border-sage/30 text-sage-dark dark:text-sage`
   - Replace `bg-green-500` checkmark with `bg-sage`

6. Keep all form logic, state, and submit handling unchanged.

Important: The Modal component adds its own p-6 padding to content, so adjust margins accordingly. The header is provided by Modal via title/description props.
  </action>
  <verify>
1. `npx tsc --noEmit -p apps/web/tsconfig.json` - TypeScript compiles
2. Verify no FocusTrap import: `! grep -q "import FocusTrap" apps/web/src/components/BookingModal.tsx`
3. Verify Modal import: `grep -q "import { Modal } from '@peacase/ui'" apps/web/src/components/BookingModal.tsx`
4. Verify no red colors: `! grep -q "bg-red-\|text-red-\|border-red-" apps/web/src/components/BookingModal.tsx`
5. Verify rose design tokens: `grep -q "bg-rose/10" apps/web/src/components/BookingModal.tsx`
  </verify>
  <done>BookingModal uses Modal from @peacase/ui, error/success states use design tokens</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit -p apps/web/tsconfig.json` - TypeScript passes
2. `grep -c "FocusTrap" apps/web/src/components/BookingModal.tsx` returns 0
3. `grep -c "Modal" apps/web/src/components/BookingModal.tsx` returns at least 2 (import + usage)
4. No legacy red/green colors in file
5. Rose and sage design tokens present for error/success states
</verification>

<success_criteria>
- BookingModal imports and uses Modal from @peacase/ui
- No duplicate focus trap, escape handler, or backdrop code
- Error states use bg-rose/10 border-rose/20 text-rose-dark
- Success states use bg-sage/10 border-sage/20 text-sage-dark
- All booking functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/18-ui-ux-consistency/18-02-SUMMARY.md`
</output>
