---
phase: 17-code-quality
plan: 06
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - apps/api/src/routes/gdpr.ts
  - apps/api/src/routes/demo.ts
  - apps/api/src/routes/integrations.ts
  - apps/api/src/routes/public.ts
  - apps/api/src/routes/webhooks.ts
  - apps/api/src/routes/onboarding.ts
  - apps/api/src/routes/ownerNotifications.ts
  - apps/api/src/routes/account.ts
  - apps/api/src/routes/users.ts
  - apps/api/src/routes/clientAuth.ts
autonomous: true

must_haves:
  truths:
    - "All ten route files use explicit Prisma types instead of any"
    - "All console.log/warn/error calls replaced with logger"
  artifacts:
    - path: "apps/api/src/routes/gdpr.ts"
      provides: "Typed GDPR queries"
      contains: "import logger from"
    - path: "apps/api/src/routes/integrations.ts"
      provides: "Typed integration queries"
      contains: "import logger from"
    - path: "apps/api/src/routes/webhooks.ts"
      provides: "Typed webhook handling"
      contains: "import logger from"
  key_links:
    - from: "apps/api/src/routes/webhooks.ts"
      to: "apps/api/src/lib/logger.ts"
      via: "import"
      pattern: "import logger from"
---

<objective>
Migrate remaining route files to use explicit Prisma types and structured logging.

Purpose: Complete route migration - these are the remaining 10 route files including GDPR, demo, integrations, public, webhooks, onboarding, ownerNotifications, account, users, and clientAuth.
Output: Ten route files with explicit types and structured logging.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-code-quality/17-RESEARCH.md
@.planning/phases/17-code-quality/17-01-SUMMARY.md
@apps/api/src/lib/logger.ts
@apps/api/src/lib/prismaUtils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate gdpr.ts, demo.ts, and integrations.ts</name>
  <files>apps/api/src/routes/gdpr.ts, apps/api/src/routes/demo.ts, apps/api/src/routes/integrations.ts</files>
  <action>
**For gdpr.ts (3 console.log calls):**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with explicit Prisma types
3. Replace 3 console.log calls with structured logger:
```typescript
logger.info({ salonId, clientId }, 'GDPR data export requested');
logger.info({ salonId, clientId }, 'GDPR data deletion completed');
```

**For demo.ts (3 console.log calls):**
1. Add imports (Prisma, logger)
2. Replace `: any` with explicit types
3. Replace 3 console.log calls with logger

**For integrations.ts (11 console.log calls):**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with appropriate types:
- `Prisma.IntegrationWhereInput` for integration queries
3. Replace 11 console.log calls with structured logger:
```typescript
logger.info({ salonId, integration }, 'Integration connected');
logger.error(err, 'Integration sync failed');
```
  </action>
  <verify>
```bash
cd apps/api && npx tsc --noEmit src/routes/gdpr.ts src/routes/demo.ts src/routes/integrations.ts
grep -c ": any" src/routes/gdpr.ts src/routes/demo.ts src/routes/integrations.ts 2>/dev/null | grep -v ":0$" || echo "All clean"
grep -c "console\." src/routes/gdpr.ts src/routes/demo.ts src/routes/integrations.ts 2>/dev/null | grep -v ":0$" || echo "All clean"
```
  </verify>
  <done>gdpr.ts, demo.ts, integrations.ts have 0 `any` types, 0 console.log calls</done>
</task>

<task type="auto">
  <name>Task 2: Migrate public.ts, webhooks.ts, and onboarding.ts</name>
  <files>apps/api/src/routes/public.ts, apps/api/src/routes/webhooks.ts, apps/api/src/routes/onboarding.ts</files>
  <action>
**For public.ts (5 console.log calls):**
1. Add imports (Prisma, logger) - may not need withSalonId for public routes
2. Replace `: any` with explicit types
3. Replace 5 console.log calls with logger

**For webhooks.ts (18 console.log calls - highest in codebase):**
1. Add imports (Prisma, logger)
2. Replace `: any` with explicit types
3. Replace 18 console.log calls with structured logger:
```typescript
logger.info({ eventType, eventId }, 'Webhook received');
logger.info({ eventType }, 'Webhook processed successfully');
logger.error(err, 'Webhook processing failed');
logger.warn({ eventId }, 'Webhook event already processed (idempotent)');
```

**For onboarding.ts (2 console.log calls):**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with explicit types
3. Replace 2 console.log calls with logger
  </action>
  <verify>
```bash
cd apps/api && npx tsc --noEmit src/routes/public.ts src/routes/webhooks.ts src/routes/onboarding.ts
grep -c "console\." src/routes/public.ts src/routes/webhooks.ts src/routes/onboarding.ts 2>/dev/null | grep -v ":0$" || echo "All clean"
```
  </verify>
  <done>public.ts, webhooks.ts, onboarding.ts have 0 `any` types, 0 console.log calls</done>
</task>

<task type="auto">
  <name>Task 3: Migrate ownerNotifications.ts, account.ts, users.ts, and clientAuth.ts</name>
  <files>apps/api/src/routes/ownerNotifications.ts, apps/api/src/routes/account.ts, apps/api/src/routes/users.ts, apps/api/src/routes/clientAuth.ts</files>
  <action>
**For ownerNotifications.ts:**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with explicit types
3. Replace any console.log calls with logger

**For account.ts:**
1. Add imports (Prisma, logger)
2. Replace `: any` with `Prisma.UserWhereInput` or `Prisma.SalonWhereInput`
3. Replace any console.log calls with logger

**For users.ts (9 salonId patterns to replace):**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with `Prisma.UserWhereInput`
3. Replace any console.log calls with logger
4. Use withSalonId for all 9 tenant filter patterns

**For clientAuth.ts:**
1. Add imports (Prisma, logger)
2. Replace `: any` with explicit types
3. Replace any console.log calls with logger
  </action>
  <verify>
```bash
cd apps/api && npx tsc --noEmit src/routes/ownerNotifications.ts src/routes/account.ts src/routes/users.ts src/routes/clientAuth.ts
grep -c ": any" src/routes/ownerNotifications.ts src/routes/account.ts src/routes/users.ts src/routes/clientAuth.ts 2>/dev/null | grep -v ":0$" || echo "All clean"
grep -c "console\." src/routes/ownerNotifications.ts src/routes/account.ts src/routes/users.ts src/routes/clientAuth.ts 2>/dev/null | grep -v ":0$" || echo "All clean"
```
  </verify>
  <done>All four files have 0 `any` types, 0 console.log calls</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cd apps/api && npm run build` passes
2. All 10 route files have zero `: any` annotations
3. All 10 route files have zero `console.` calls
4. All 28 route files are now migrated (plans 02-06)
</verification>

<success_criteria>
- All ten route files compile without TypeScript errors
- Zero `: any` type annotations in these files
- Zero console.log/warn/error calls in these files
- All 28 route files now use structured logger
- Route migration complete
</success_criteria>

<output>
After completion, create `.planning/phases/17-code-quality/17-06-SUMMARY.md`
</output>
