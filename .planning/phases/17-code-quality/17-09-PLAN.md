---
phase: 17-code-quality
plan: 09
type: execute
wave: 3
depends_on: ["17-02", "17-03", "17-04", "17-05", "17-06", "17-07", "17-08"]
files_modified:
  - apps/api/tsconfig.json
autonomous: true

must_haves:
  truths:
    - "tsconfig.json has noImplicitAny: true"
    - "API builds successfully with noImplicitAny enabled"
    - "No grep results for ': any' in route files"
  artifacts:
    - path: "apps/api/tsconfig.json"
      provides: "Strict TypeScript configuration"
      contains: "noImplicitAny\": true"
  key_links:
    - from: "apps/api/tsconfig.json"
      to: "apps/api/src/**/*.ts"
      via: "TypeScript compilation"
      pattern: "noImplicitAny.*true"
---

<objective>
Enable noImplicitAny: true in API tsconfig.json and verify successful build.

Purpose: This is the final step that enforces CODE-02 (noImplicitAny: true). All type fixes from previous plans must be complete before enabling this flag.
Output: Updated tsconfig.json with noImplicitAny: true and passing build.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-code-quality/17-RESEARCH.md
@apps/api/tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pre-flight check - verify type fixes are complete</name>
  <files>apps/api/src/routes/*.ts</files>
  <action>
Before enabling noImplicitAny, verify all route files are properly typed:

1. Check for remaining `: any` patterns in routes:
```bash
cd apps/api && grep -r ": any" src/routes/ || echo "No any types found"
```

2. Check that all route files import Prisma types:
```bash
cd apps/api && grep -L "import.*Prisma" src/routes/*.ts || echo "All files import Prisma"
```

3. Run TypeScript check to see current error count:
```bash
cd apps/api && npx tsc --noEmit 2>&1 | wc -l
```

If any route files still have `: any`, fix them before proceeding. The goal is to have minimal (<10) type errors remaining when we enable the flag.

Document findings and fix any remaining issues.
  </action>
  <verify>
```bash
cd apps/api && grep -c ": any" src/routes/*.ts 2>/dev/null | grep -v ":0$" | wc -l
```
Result should be 0 (no files with `: any`).
  </verify>
  <done>All route files have 0 `: any` type annotations</done>
</task>

<task type="auto">
  <name>Task 2: Enable noImplicitAny and fix remaining errors</name>
  <files>apps/api/tsconfig.json</files>
  <action>
1. Update `apps/api/tsconfig.json` to enable noImplicitAny:
```json
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "./src",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "noEmit": false,
    "allowImportingTsExtensions": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noImplicitAny": true,
    "skipLibCheck": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "src/__tests__"]
}
```

2. Run TypeScript check:
```bash
cd apps/api && npx tsc --noEmit
```

3. If errors appear, analyze and fix them:
- For implicit `any` in function parameters: add explicit types
- For implicit `any` in variable declarations: use explicit Prisma types or infer from context
- For pre-existing subscription errors: these may need specific attention (documented in STATE.md as known issue)

4. Continue fixing until build passes or only known pre-existing errors remain.
  </action>
  <verify>
```bash
cd apps/api && npx tsc --noEmit && echo "Build passed"
```
Build should pass with noImplicitAny: true.
  </verify>
  <done>tsconfig.json has noImplicitAny: true and build passes</done>
</task>

<task type="auto">
  <name>Task 3: Final verification of all CODE requirements</name>
  <files>apps/api/src/**/*.ts</files>
  <action>
Verify all four CODE requirements are met:

**CODE-01: All filter objects in routes use explicit Prisma types**
```bash
cd apps/api && grep -r ": any" src/routes/ && echo "FAIL: any types found" || echo "PASS: no any types"
```

**CODE-02: API tsconfig.json has noImplicitAny: true**
```bash
cd apps/api && grep "noImplicitAny.*true" tsconfig.json && echo "PASS" || echo "FAIL"
```

**CODE-03: Shared salonId filter utility is used**
```bash
cd apps/api && grep -r "withSalonId" src/routes/ | wc -l
```
Should show significant usage (target: ~50+ uses across route files)

**CODE-04: Console.log replaced with structured logger**
```bash
cd apps/api && grep -r "console\." src/ --include="*.ts" | grep -v "__tests__" | grep -v "node_modules" && echo "FAIL" || echo "PASS: no console.log"
```

Document results for each requirement.
  </action>
  <verify>
All four CODE requirements pass verification checks.
  </verify>
  <done>All CODE-01, CODE-02, CODE-03, CODE-04 requirements verified</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `grep "noImplicitAny.*true" apps/api/tsconfig.json` returns match
2. `cd apps/api && npm run build` passes
3. `grep -r ": any" apps/api/src/routes/` returns empty
4. `grep -r "console\." apps/api/src/ --include="*.ts" | grep -v "__tests__"` returns empty
5. All four CODE requirements documented as passing
</verification>

<success_criteria>
- tsconfig.json has noImplicitAny: true
- API build passes with strict typing
- Zero `: any` in route files
- Zero console.log in non-test source files
- All four CODE requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/17-code-quality/17-09-SUMMARY.md`
</output>
