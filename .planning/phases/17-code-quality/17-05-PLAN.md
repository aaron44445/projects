---
phase: 17-code-quality
plan: 05
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - apps/api/src/routes/auth.ts
  - apps/api/src/routes/dashboard.ts
  - apps/api/src/routes/locations.ts
  - apps/api/src/routes/salon.ts
  - apps/api/src/routes/team.ts
  - apps/api/src/routes/notifications.ts
autonomous: true

must_haves:
  truths:
    - "All six route files use explicit Prisma types instead of any"
    - "All console.log/warn/error calls replaced with logger"
    - "All salonId filters use withSalonId utility"
  artifacts:
    - path: "apps/api/src/routes/auth.ts"
      provides: "Typed auth queries"
      contains: "import logger from"
    - path: "apps/api/src/routes/dashboard.ts"
      provides: "Typed dashboard queries"
      contains: "import logger from"
    - path: "apps/api/src/routes/locations.ts"
      provides: "Typed location queries"
      contains: "withSalonId"
    - path: "apps/api/src/routes/salon.ts"
      provides: "Typed salon queries"
      contains: "import logger from"
    - path: "apps/api/src/routes/team.ts"
      provides: "Typed team queries"
      contains: "import logger from"
    - path: "apps/api/src/routes/notifications.ts"
      provides: "Typed notification queries"
      contains: "import logger from"
  key_links:
    - from: "apps/api/src/routes/dashboard.ts"
      to: "apps/api/src/lib/logger.ts"
      via: "import"
      pattern: "import logger from"
---

<objective>
Migrate system/core route files to use explicit Prisma types and structured logging.

Purpose: These routes handle authentication, dashboard, locations, salon settings, team management, and notifications. They are core system routes used across the application.
Output: Six route files with explicit types, withSalonId usage, and structured logging.
</objective>

<execution_context>
@C:\Users\aaron\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aaron\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-code-quality/17-RESEARCH.md
@.planning/phases/17-code-quality/17-01-SUMMARY.md
@apps/api/src/lib/logger.ts
@apps/api/src/lib/prismaUtils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate auth.ts and dashboard.ts</name>
  <files>apps/api/src/routes/auth.ts, apps/api/src/routes/dashboard.ts</files>
  <action>
**For auth.ts:**
1. Add imports:
```typescript
import { Prisma } from '@prisma/client';
import logger from '../lib/logger.js';
```
Note: auth.ts may not need withSalonId since it handles login before salonId is known

2. Replace `: any` with explicit types:
- `Prisma.UserWhereInput` for user lookups
- `Prisma.SalonWhereInput` for salon lookups

3. Replace 1 console.log call with logger

4. For auth routes, log security events:
```typescript
logger.info({ userId, email }, 'User logged in');
logger.warn({ email }, 'Failed login attempt');
```

**For dashboard.ts:**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with explicit types (this file has consolidated queries from Phase 14)
3. No console.log calls expected (dashboard is read-only)
4. Use withSalonId for all tenant filtering
  </action>
  <verify>
```bash
cd apps/api && npx tsc --noEmit src/routes/auth.ts src/routes/dashboard.ts
grep -c ": any" src/routes/auth.ts || echo "0"
grep -c ": any" src/routes/dashboard.ts || echo "0"
grep -c "console\." src/routes/auth.ts || echo "0"
grep -c "console\." src/routes/dashboard.ts || echo "0"
```
  </verify>
  <done>auth.ts and dashboard.ts have 0 `any` types, 0 console.log calls</done>
</task>

<task type="auto">
  <name>Task 2: Migrate locations.ts and salon.ts</name>
  <files>apps/api/src/routes/locations.ts, apps/api/src/routes/salon.ts</files>
  <action>
**For locations.ts:**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with `Prisma.LocationWhereInput`
3. Replace any console.log calls with logger
4. Use withSalonId for all location queries

**For salon.ts:**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with appropriate types:
- `Prisma.SalonWhereInput` for salon queries
- `Prisma.SalonUpdateInput` for update operations
3. Replace any console.log calls with logger
4. Use withSalonId where appropriate (some salon routes may use id directly)
  </action>
  <verify>
```bash
cd apps/api && npx tsc --noEmit src/routes/locations.ts src/routes/salon.ts
grep -c ": any" src/routes/locations.ts || echo "0"
grep -c ": any" src/routes/salon.ts || echo "0"
grep -c "console\." src/routes/locations.ts || echo "0"
grep -c "console\." src/routes/salon.ts || echo "0"
```
  </verify>
  <done>locations.ts and salon.ts have 0 `any` types, 0 console.log calls</done>
</task>

<task type="auto">
  <name>Task 3: Migrate team.ts and notifications.ts</name>
  <files>apps/api/src/routes/team.ts, apps/api/src/routes/notifications.ts</files>
  <action>
**For team.ts:**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with appropriate types:
- `Prisma.StaffWhereInput` or `Prisma.UserWhereInput` for team queries
3. Replace 2 console.log calls with logger
4. Use withSalonId for tenant filtering

**For notifications.ts:**
1. Add imports (Prisma, logger, withSalonId)
2. Replace `: any` with `Prisma.NotificationWhereInput`
3. Replace 2 console.log calls with logger:
```typescript
logger.info({ notificationId, recipientId }, 'Notification sent');
logger.error(err, 'Failed to send notification');
```
4. Use withSalonId for notification queries
  </action>
  <verify>
```bash
cd apps/api && npx tsc --noEmit src/routes/team.ts src/routes/notifications.ts
grep -c ": any" src/routes/team.ts || echo "0"
grep -c ": any" src/routes/notifications.ts || echo "0"
grep -c "console\." src/routes/team.ts || echo "0"
grep -c "console\." src/routes/notifications.ts || echo "0"
```
  </verify>
  <done>team.ts and notifications.ts have 0 `any` types, 0 console.log calls</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cd apps/api && npm run build` passes
2. Zero `: any` in all six files
3. Zero `console.` in all six files
4. All files import logger (withSalonId where needed)
</verification>

<success_criteria>
- All six route files compile without TypeScript errors
- Zero `: any` type annotations in these files
- Zero console.log/warn/error calls in these files
- All files use structured logger
- All tenant-scoped files use withSalonId
</success_criteria>

<output>
After completion, create `.planning/phases/17-code-quality/17-05-SUMMARY.md`
</output>
