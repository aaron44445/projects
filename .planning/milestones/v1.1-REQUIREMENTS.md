# Requirements Archive: v1.1 Audit Remediation

**Archived:** 2026-01-29
**Status:** âœ… SHIPPED

This is the archived requirements specification for v1.1.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: Peacase v1.1 Audit Remediation

**Defined:** 2026-01-28
**Shipped:** 2026-01-29
**Core Value:** Every workflow a spa owner needs must work reliably, end-to-end, every time.

## v1.1 Requirements

Requirements for audit remediation. Each maps to roadmap phases.

### Security

- [x] **SEC-01**: Application enforces ENCRYPTION_KEY in production (fails startup if missing)
- [x] **SEC-02**: Application enforces JWT_SECRET in production (fails startup if missing)
- [x] **SEC-03**: File DELETE endpoint validates ownership via database lookup, not path
- [x] **SEC-04**: Password validation requires uppercase, lowercase, number, and special character

### Performance

- [x] **PERF-01**: Email/SMS notifications are queued asynchronously (don't block API responses)
- [x] **PERF-02**: Dashboard stats endpoint uses 2-3 consolidated queries instead of 8
- [x] **PERF-03**: VIP client count uses database COUNT, not client-side filtering
- [x] **PERF-04**: Dashboard hook has refetchIntervalInBackground: false

### SEO

- [x] **SEO-01**: sitemap.ts generates dynamic sitemap at /sitemap.xml
- [x] **SEO-02**: robots.txt allows public pages, blocks /dashboard and /admin
- [x] **SEO-03**: All public pages have canonical URLs in metadata
- [x] **SEO-04**: Landing page has Organization and SoftwareApplication JSON-LD schemas

### Accessibility

- [x] **A11Y-01**: All modals have role="dialog", aria-modal="true", and focus trap
- [x] **A11Y-02**: Time slot buttons in booking widget have aria-label attributes
- [x] **A11Y-03**: Root layout has "Skip to main content" link for keyboard users
- [x] **A11Y-04**: Text using charcoal/70 opacity increased to charcoal/80 for contrast

### Code Quality

- [x] **CODE-01**: All filter objects in routes use explicit Prisma types (no `any`)
- [x] **CODE-02**: API tsconfig.json has noImplicitAny: true
- [x] **CODE-03**: Common salonId filter patterns extracted to shared utility
- [x] **CODE-04**: Console.log/warn/error replaced with structured logger

### UI/UX

- [x] **UI-01**: All modal dialogs use packages/ui Modal component (not custom implementations)
- [x] **UI-02**: Status/tag colors defined in single shared constants file
- [x] **UI-03**: Error states use design tokens (error/10, error/20) not hardcoded colors
- [x] **UI-04**: Empty states use reusable EmptyState component

## Future Requirements

Deferred to v1.2:

### Staff Portal
- **PORTAL-01**: Staff can log in with separate auth flow
- **PORTAL-02**: Staff can clock in/out
- **PORTAL-03**: Staff can view earnings

### Settings Polish
- **SET-01**: Subscription add-on persistence
- **SET-02**: Multi-location CRUD UI completion

## Out of Scope

| Feature | Reason |
|---------|--------|
| Redis for CSRF tokens | In-memory acceptable for single instance |
| Virus scanning on uploads | Cloudinary provides protection |
| Access token lifetime reduction | Would require significant testing |
| Compression middleware | Vercel/Render handle this |
| Full WCAG 2.2 compliance | 2.1 AA is the legal requirement |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| SEC-01 | Phase 13: Security Hardening | Complete |
| SEC-02 | Phase 13: Security Hardening | Complete |
| SEC-03 | Phase 13: Security Hardening | Complete |
| SEC-04 | Phase 13: Security Hardening | Complete |
| PERF-01 | Phase 14: Performance Optimization | Complete |
| PERF-02 | Phase 14: Performance Optimization | Complete |
| PERF-03 | Phase 14: Performance Optimization | Complete |
| PERF-04 | Phase 14: Performance Optimization | Complete |
| SEO-01 | Phase 15: SEO Fundamentals | Complete |
| SEO-02 | Phase 15: SEO Fundamentals | Complete |
| SEO-03 | Phase 15: SEO Fundamentals | Complete |
| SEO-04 | Phase 15: SEO Fundamentals | Complete |
| A11Y-01 | Phase 16: Accessibility Compliance | Complete |
| A11Y-02 | Phase 16: Accessibility Compliance | Complete |
| A11Y-03 | Phase 16: Accessibility Compliance | Complete |
| A11Y-04 | Phase 16: Accessibility Compliance | Complete |
| CODE-01 | Phase 17: Code Quality | Complete |
| CODE-02 | Phase 17: Code Quality | Complete |
| CODE-03 | Phase 17: Code Quality | Complete |
| CODE-04 | Phase 17: Code Quality | Complete |
| UI-01 | Phase 18: UI/UX Consistency | Complete |
| UI-02 | Phase 18: UI/UX Consistency | Complete |
| UI-03 | Phase 18: UI/UX Consistency | Complete |
| UI-04 | Phase 18: UI/UX Consistency | Complete |

**Coverage:**
- v1.1 requirements: 24 total
- Satisfied: 24 (100%)

---

## Milestone Summary

**Shipped:** 24 of 24 v1.1 requirements
**Adjusted:** None
**Dropped:** None

All requirements were satisfied as originally specified with no scope changes.

---
*Archived: 2026-01-29 as part of v1.1 milestone completion*
